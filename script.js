const changelogData = {
    "21/12/2024": [
        { "category": "Added", "description": "New ERPT Cmd 308 (Ross)" },
        { "category": "Fixed", "description": "Raptor XC90 Handling (Ross)" },
        { "category": "Fixed", "description": "RTPC RS3 Handling (Ross)" },
        { "category": "Fixed", "description": "SC RS3 Handling (Ross)" },
        { "category": "Removed", "description": "Polestar 2 (Ross)" },
        { "category": "Removed", "description": "RTPC V90 '18 (Ross)" },
        { "category": "Removed", "description": "BMW '22 530i (Moved to EG) (Ross)" },
        { "category": "Added", "description": "New UM X5 (Ross)" },
        { "category": "Added", "description": "Better ticket transcripts using discord-html-transcripts module. (Jack)" },
        { "category": "Added", "description": "/close-rq and /close that fully works. FINALLY!!! (Jack)" },
        { "category": "Added", "description": "Join & Leave Logs. (Jack)" },
        { "category": "Removed", "description": "Booster Event (Doesn't function properly.) (Jack)" },
        { "category": "Added", "description": "/role-stats to display the people that hold the specified role. (Jack)" },
        { "category": "Added", "description": "Ticket resolve time to close embeds using MongoDB. (Jack)" },
        { "category": "Updated", "description": "AI Interactions, ID Card to have a holographic effect. (Jack)" },
        { "category": "Updated", "description": "Polac Form NUI (Jack)" },
        { "category": "Added", "description": "New ERPT Kuga (Ross)" },
        { "category": "Removed", "description": "Unnecessary Info Embed in tickets. (Jack)" },
        { "category": "Added", "description": "z-els for all 400 cars (Ross)" },
        { "category": "Added", "description": "PAVA Script (Ross)" },
        { "category": "Added", "description": "Realistic handcuffing script (/cuffs)(/uncuffs) (Ross)" },
        { "category": "Added", "description": "New Hospital (P: 149) (Ross)" },
        { "category": "Added", "description": "Pillbox MLO (Ross)" },
        { "category": "Added", "description": "Crusade VS (Ross)" },
        { "category": "Added", "description": "Crusade Spawn (Ross)" },
        { "category": "Added", "description": "Crusade EUP Menu (Ross)" },
        { "category": "Moved", "description": "Pillbox EUP, VS, Spawn (Ross)" },
        { "category": "Added", "description": "Wicking shirts (Ross)" },
        { "category": "Added", "description": "MPU Boat (Ross)" },
        { "category": "Added", "description": "New HART EUP (Ross)" },
        { "category": "Added", "description": "TSG Uniform (Ross)" },
        { "category": "Added", "description": "New MPU Kit (Ross)" },
        { "category": "Added", "description": "SORT Uniform (Ross)" },
        { "category": "Added", "description": "Del Perro PD (Ross)" },
        { "category": "Added", "description": "z_fires (Ross)" },
        { "category": "Added", "description": "z_hose (Ross)" },
        { "category": "Added", "description": "Drone Scripts (Ross)" }
    ],
    "17/12/2024": [
    { "category": "Added", "description": "LAS IC Tabards (Ross)" },
    { "category": "Added", "description": "New HEMS VS (Ross)" },
    { "category": "Added", "description": "New HEMS EUP Menu (Ross)" },
    { "category": "Added", "description": "HEMS base to Spawn menu (Ross)" },
    { "category": "Added", "description": "Pillbox to spawn menu (Ross)" },
    { "category": "Added", "description": "Sandy to Spawn menu (Ross)" },
    { "category": "Added", "description": "4 new CoLP Uniforms (Ross)" },
    { "category": "Added", "description": "New pattern for Audi RS5 (Ross)" },
    { "category": "Added", "description": "HART USAR Car (Ross)" },
    { "category": "Added", "description": "3 new LAS Cmd Cars (Ross)" },
    { "category": "Added", "description": "2 new CoLP Cars (Ross)" },
    { "category": "Added", "description": "1 new Raptor XC90 (Ross)" },
    { "category": "Added", "description": "New ARV XC90 (Ross)" },
    { "category": "Added", "description": "New CT XC90 (Ross)" },
    { "category": "Added", "description": "New Events Car (Ross)" },
    { "category": "Added", "description": "New Jag (Ross)" },
    { "category": "Added", "description": "New ERPT Command Peugeot 308 (Ross)" },
    { "category": "Added", "description": "2 new ARV's (Ross)" },
    { "category": "Added", "description": "1 new V90 (Ross)" },
    { "category": "Added", "description": "New Staff Jumpers (Ross)" },
    { "category": "Added", "description": "5 new Donator Cars (Ross)" },
    { "category": "Added", "description": "Cupra (Ross)" },
    { "category": "Added", "description": "Kuga (Ross)" },
    { "category": "Added", "description": "Santa Fe (Ross)" },
    { "category": "Added", "description": "Rav-4 (Ross)" },
    { "category": "Added", "description": "Audi S63 (Ross)" },
    { "category": "Added", "description": "New light pattern for all vehicles (Ross)" },
    { "category": "Fixed", "description": "Arktis LBV having cut off ranks (Ross)" },
    { "category": "Cleared", "description": "Server Cache (Ross)" },
    { "category": "Fixed", "description": "RTPC no taser LBV (Ross)" },
    { "category": "Fixed", "description": "All ERPT uniforms having no Tasers (Ross)" },
    { "category": "Fixed", "description": "DSU Vesst #3 having no taser (PC-Insp) (Ross)" },
    { "category": "Fixed", "description": "trousers?? (Ross)" },
    { "category": "Fixed", "description": "Audi A6 Flash pattern (Ross)" },
    { "category": "Fixed", "description": "I30n Handling (Ross)" },
    { "category": "Fixed", "description": "RS3 handling (Ross)" },
    { "category": "Fixed", "description": "Visor flashing on ELS (Ross)" },
    { "category": "Removed", "description": "HEMS EUP from LAS EUP Menus (Ross)" },
    { "category": "Removed", "description": "HEMS Cars from LAS VS's (Ross)" },
    { "category": "Removed", "description": "2 Outdated ARV's (Ross)" },
    { "category": "Updated", "description": "LAS VS Menu (Ross)" },
    { "category": "Updated", "description": "New cars to Pillbox and Sandy LAS VS's (Ross)" },
    { "category": "Updated", "description": "Discord Rich Presence (Jack)" }
],
    "10/12/2024": [
        { category: "Added", description: "New AFO XC90 - Colour changing (Ross)" },
        { category: "Added", description: "New AFO XC90 - White (Ross)" },
        { category: "Added", description: "Webhook logging to Entity Deletion Weapon (Jack)" },
        { category: "Added", description: "Website link to Support Auto Embed (Macho)" },
        { category: "Added", description: "Message Delete on Auto Messager Member Trigger (Macho)" },
        { category: "Added", description: "XXXXX Car #7 (Ross)" },
        { category: "Added", description: "XXXXX Car #6 (Ross)" },
        { category: "Added", description: "XXXXX Car #8 (Ross)" },
        { category: "Added", description: "Snowball Script (Ross)" },
        { category: "Added", description: "Dev Garage to Admin Menu (Ross)" },
        { category: "Added", description: "Dev S60 (Ross)" },
        { category: "Added", description: "MO19 XC90 (Ross)" },
        { category: "Added", description: "All new Command Members to website (Jack)" },
        { category: "Added", description: "/admin-dm for Management to message members in Discord (Jack)" },
        { category: "Added", description: "Operations Manager Ranks to LAS EUP Menu (Ross)" },
        { category: "Added", description: "ERPT Command G31 (Ross)" },
        { category: "Added", description: "/las-tags (LAS TM+) to add LAS roles (Jack)" },
        { category: "Added", description: "How to apply for LAS on the website (Jack)" },
        { category: "Added", description: "/loa-list to show who's on loa (Jack)" },
        { category: "Added", description: "Sussex Police Car (Jack's Personal) (Ross)" },
        { category: "Added", description: "New ARV X5 (Ross)" },
        { category: "Added", description: "/ipp-tags for ERPT Command (Macho)" },
        { category: "Added", description: "MO19 V90 Marked" },
        { category: "Added", description: "New Taser 10 (Ross)" },
        { category: "Added", "description": "give and remove weapons (/give-weapons [ID]) (Jack)" },
        { category: "Added", description: "Secret Command for Founders when on Major incidents (Jack)" },
        { category: "Added", description: "/donator-tags to discord bot (Jack)" },
        { category: "Added", description: "Webhook logging for Attempting to send DM and DM Sent Successfully when a user joins the guild. (Jack)" },
        { category: "Added", description: "New RTPC M135i (Ross)" },
        { category: "Added", description: "AFO A6 (Ross)" },
        { category: "Added", description: "AFO A4 (Ross)" },
        { category: "Added", description: "AFO G30 (Ross)" },
        { category: "Added", description: "AFO G30 (2) (Ross)" },
        { category: "Added", description: "AFO V90 - UM (Ross)" },
        { category: "Added", description: "AFO V90 (M) (Ross)" },
        { category: "Added", description: "AFO XC60 (Ross)" },
        { category: "Added", description: "Pol Cmd Visor G31 (Ross)" },
        { category: "Added", description: "Misc XC90 (Bugged üòê) (Ross)" },
        { category: "Added", description: "ERPT Rural V90 Cross Country (Ross)" },
        { category: "Added", description: "Black AFO Cap (Ross)" },
        { category: "Added", description: "ECU üòâ(Ross)" },
        { category: "Added", description: "2 New X5 GO5's (AFO) (Ross)" },
        { category: "Added", description: "New Black XC90 (AFO) (Ross)" },
        { category: "Added", description: "Faster Light Patterns to all vehicles (Ross)" },
        { category: "Added", description: "/ukrp-closerq (Jack)" },
        { category: "Added", description: "Current Callsign text which links up with MDT (Jack)" },
        { category: "Added", description: "Founder Menu (Jack)" },
        { category: "Fixed", description: "Discord Bot Messages that include emojis showing as \"??\" (Jack)" },
        { category: "Fixed", description: "Civ Firearms Gun Perms not working (Jack)" },
        { category: "Fixed", description: "Donation Message Handler Embed to work with new store (Jack)" },
        { category: "Fixed", description: "Light blue lights on Sussex car (Ross)" },
        { category: "Fixed", description: "Light blue lights on X5 (Ross)" }
    ],
    "20/11/2024": [
        { category: "Added", description: "@User before closing the ticket to identify who closed the ticket (Macho)" },
        { category: "Added", description: "New close command to tickets (Macho)" },
        { category: "Added", description: "Custom emojis to the /Support drop menu (Macho)" },
        { category: "Added", description: "New commands to the bot: /myid & /ping (Jack)" },
        { category: "Added", description: "New command to add/remove users for temp tickets (Macho)" },
        { category: "Added", description: "New command to add/remove users from normal tickets (Macho)" },
        { category: "Added", description: "AFO Jaguar F-Pace command (Ross)" },
        { category: "Added", description: "Reskinned HEMS G31 (broken ELS) (Ross)" },
        { category: "Added", description: "HEMS Doctor category to LAS VS (Ross)" },
        { category: "Added", description: "Audi RS8 - Fixed ELS issue (Ross)" },
        { category: "Added", description: "5 new *secret* vehicles (Ross)" },
        { category: "Added", description: "New Change-log Web (Jack)" },
        { category: "Added", description: "New Website (Jack)" },
        { category: "Added", description: "Chat logs (Jack)" },
        { category: "Added", description: "LAS V60 (Ross)" },
        { category: "Added", description: "Auto Responses to Ticket Bot will Read these updates, support, guides (Macho)" },
        { category: "Added", description: "Better logging to Assessment checking (Jack)" },
        { category: "Added", description: "/cfx-status which uses an API to check the current cfx.re status. (Discord) (Jack)" },
        { category: "Added", description: "LOA System (Discord) (Jack)" },
        { category: "Added", description: "Email system for GC to track command emails. /add-email, /get-email, /list-emails, /remove-email (Jack)" },
        { category: "Added", description: "Entity deletion gun that properly takes control of networked entities and can delete vehicles with other players inside it. (Jack)" },
        { category: "Added", description: "/remove-loa (Discord) (Jack)" },
        { category: "Added", description: "Polac Reporting system (/polac) (Jack)" },
        { category: "Fixed", description: "/check-assessment breaking due to the fact I forgot to define the packages (Jack)" },
        { category: "Fixed", description: "Temp / Normal Ticket Buttons and a few Misc Spelling Errors (Macho)" },
        { category: "Fixed", description: "The bot crashing when using host-event buttons. (Discord bot) (Jack)" },
        { category: "Fixed", description: "RTPC having Dr Car (Ross)" },
        { category: "Fixed", description: "LAS Command Permissions (Ross)" },
        { category: "Fixed", description: "ELS on HEMS G31 (Ross)" },
        { category: "Fixed", description: "API error on closing tickets (Macho)" },
        { category: "Fixed", description: "Transcript errors crashing the bot (Macho)" },
        { category: "Fixed", description: "Close and delete buttons now only send transcripts to DM, and delete logs to the channel (Macho)" },
        { category: "Fixed", description: "Transcript buttons (Macho)" },
        { category: "Fixed", description: "@TicketRoleId now supports both removing and adding roles to tickets (Macho)" },
        { category: "Fixed", description: "Retro rotator light (actually spins) (Ross)" }
    ],
    "16/11/2024": [
      { category: "Added", description: "AI Menu (Jack)" },
      { category: "Added", description: "Questions to AI Menu (Jack)" },
      { category: "Added", description: "Searching to AI Menu (Jack)" },
      { category: "Added", description: "Freeze Ped Function for AI Interactions (Jasper)" },
      { category: "Added", description: "Cuff Ped Function for AI Interactions (Jasper)" },
      { category: "Added", description: "ID System with Ped Face Headshot AI Interactions (Jack)" },
      { category: "Added", description: "British Licence Template (Jasper)" },
      { category: "Added", description: "PNC Checking and Markers to AI Interactions (Jack)" },
      { category: "Added", description: "/pnc-check [NAME] to AI Interactions (Jack)" },
      { category: "Added", description: "Send to Custody to AI Interactions (Jack)" },
      { category: "Added", description: "Drag AI Peds to AI Interactions (Jack)" },
      { category: "Added", description: "/openspawnselect to welcome message (Jack)" },
      { category: "Added", description: "Ticket System (Macho)" },
      { category: "Added", description: "Multiple LAS/Doctor Cars (Ross)" },
      { category: "Added", description: "New MO19 Vehicles (Ross)" },
      { category: "Added", description: "Function to stop all AI Tasks AI Interactions (Jasper)" },
      { category: "Added", description: "Blips for Stations and MLOs (Jasper)" },
      { category: "Added", description: "Hairmenu (Jasper)" },
      { category: "Added", description: "Shooting Logs (Jasper / Jack)" },
      { category: "Added", description: "Discord Chat Roles (Jack)" },
      { category: "Added", description: "LAS EUP Menus (Ross)" },
      { category: "Added", description: "LAS Vehicle Spawners (Ross)" },
      { category: "Added", description: "Custody EUP Menu's (Ross)" },
      { category: "Added", description: "LAS and Custody Locations to spawn select (Ross)" },
      { category: "Added", description: "Ace Permed Medical Menu (Jack)" },
      { category: "Fixed", description: "Wrong Textures on Vehicles (Ross)" },
      { category: "Fixed", description: "When Pressing E in a vehicle it stops a Ped (Jack)" },
      { category: "Fixed", description: "Ped not freezing after stopping one before (Jack)" },
      { category: "Fixed", description: "Errors with the Ticket bot and restrictions (Macho)" },
      { category: "Fixed", description: "Shooting logs spamming console (Jack)" },
      { category: "Fixed", description: "Civ armoury Perms (Ross)" },
      { category: "Fixed", description: "Wrong styling on ID Card, AI Interactions (Jasper)" },
      { category: "Removed", description: "The lastmessagetimes() function so Shoot logs function properly. (Jack)" },
      { category: "Removed", description: "LAS commands. (Jack)" }
    ],
};

const changelogContent = document.getElementById("changelog-content");

// Group changes by month
const groupedChanges = {};
Object.entries(changelogData).forEach(([date, changes]) => {
    const [day, month, year] = date.split('/');
    const monthYear = `${new Date(year, month - 1).toLocaleString('default', { month: 'long' })} ${year}`;
    
    if (!groupedChanges[monthYear]) {
        groupedChanges[monthYear] = [];
    }
    
    groupedChanges[monthYear].push({
        date: `${day}/${month}/${year}`,
        changes
    });
});

// Render grouped changes
Object.entries(groupedChanges).forEach(([monthYear, dates]) => {
    const monthSection = document.createElement('div');
    monthSection.className = 'month-section';
    
    const monthHeader = document.createElement('h3');
    monthHeader.className = 'month-header';
    monthHeader.textContent = monthYear;
    monthSection.appendChild(monthHeader);

    dates.forEach(({ date, changes }) => {
        const dateDiv = document.createElement("div");
        dateDiv.className = "changelog-date";
        
        const dateHeader = document.createElement("div");
        dateHeader.className = "date-header";
        dateHeader.innerHTML = `
            <span class="date-text">${date}</span>
            <button class="expand-btn" aria-label="Toggle changes">
                <svg class="chevron-icon" viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                </svg>
            </button>
        `;
        dateDiv.appendChild(dateHeader);

        const changesDiv = document.createElement("div");
        changesDiv.className = "changes-container";

        const categories = {};
        changes.forEach((change) => {
            if (!categories[change.category]) {
                categories[change.category] = [];
            }
            categories[change.category].push(change.description);
        });

        Object.entries(categories).forEach(([category, descriptions]) => {
            const categoryDiv = document.createElement("div");
            categoryDiv.className = "category-section";
            
            const categoryHeader = document.createElement("h4");
            categoryHeader.className = `category ${category.toLowerCase()}`;
            categoryHeader.textContent = category;
            categoryDiv.appendChild(categoryHeader);

            const ul = document.createElement("ul");
            descriptions.forEach((desc) => {
                const li = document.createElement("li");
                li.textContent = desc;
                ul.appendChild(li);
            });
            categoryDiv.appendChild(ul);
            changesDiv.appendChild(categoryDiv);
        });

        dateDiv.appendChild(changesDiv);
        monthSection.appendChild(dateDiv);
    });
    
    changelogContent.appendChild(monthSection);
});

// Add click event listeners for expand/collapse
document.querySelectorAll('.date-header').forEach(header => {
    header.addEventListener('click', () => {
        const container = header.nextElementSibling;
        const button = header.querySelector('.expand-btn');
        const isExpanded = container.classList.contains('expanded');
        
        container.classList.toggle('expanded');
        button.classList.toggle('expanded');
        
        if (isExpanded) {
            container.style.maxHeight = '0';
        } else {
            container.style.maxHeight = container.scrollHeight + 'px';
        }
    });
});

const backToTopButton = document.getElementById("back-to-top");
window.addEventListener("scroll", () => {
    if (window.scrollY > 300) {
        backToTopButton.style.display = "flex";
    } else {
        backToTopButton.style.display = "none";
    }
});

backToTopButton.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
});

document.querySelectorAll('.changelog-item').forEach(item => {
    item.addEventListener('click', () => {
        item.classList.add('highlight');
        setTimeout(() => item.classList.remove('highlight'), 1000);
    });
});

document.body.style.cursor = 'url(path/to/christmas-cursor.png), auto';

document.querySelectorAll('.changelog-item, .join-server, h1, h2, h3')
    .forEach(element => {
        element.addEventListener('mousemove', addSparkle);
    });